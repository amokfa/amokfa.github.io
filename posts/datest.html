<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><link rel="icon" href="/favicon.ico" sizes="32x32" type="image/x-icon"><meta name="viewport" content="width=device-width, min-width=600, initial-scale=1, minimum-scale=1"><style>.svg-icon{width:2em;height:2em;background-size:contain;background-repeat:no-repeat;display:inline-block}.svg-icon.email{background-image:url("/static/img/icons/email.svg")}.svg-icon.facebook{background-image:url("/static/img/icons/facebook.svg")}.svg-icon.github{background-image:url("/static/img/icons/github.svg")}.svg-icon.twitter{background-position:0 3px;background-image:url("/static/img/icons/twitter.svg")}.svg-icon.reddit{background-image:url("/static/img/icons/reddit.svg")}.svg-icon.hn{background-image:url("/static/img/icons/hn.svg")}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,var,b,u,i,center,dl,dt,dd,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;font-size:1em;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}table{border-collapse:collapse;border-spacing:0}:root{background:#383838;box-sizing:border-box;scroll-behavior:smooth}*{box-sizing:inherit}:root{overflow-x:hidden}body{user-select:none;font-family:"Roboto",sans-serif;width:100%}body #right-sidebar .etopower{display:none;transform:translateX(50%) translateY(-50%) rotateZ(45deg);position:absolute}@media(min-width: 800px){body #right-sidebar .etopower{width:250px;height:250px;top:-1em;right:-1em}}@media(max-width: 800px){body #right-sidebar .etopower{width:60vw;height:60vw;top:0;right:0}}@media(max-width: 800px){body{font-size:.85em;padding:0}body #left-sidebar,body #right-sidebar{width:100%;height:100%;position:fixed;top:0}body #left-sidebar{left:-100%}body #right-sidebar{left:100%}body>.first_body_wrapper{width:100%}}@media(min-width: 800px){body{font-size:1em;padding:1em;display:flex;grid-gap:1em;flex-direction:row;align-items:flex-start}body #left-sidebar,body #right-sidebar{position:sticky;top:1em;height:calc(100vh - 2em)}body #left-sidebar,body #right-sidebar,body>.first_body_wrapper{width:0;flex-grow:1;flex-shrink:0}body>.first_body_wrapper{flex-grow:2}body>.first_body_wrapper{order:2;user-select:text}body #left-sidebar{order:1}body #right-sidebar{order:3}}body #left-sidebar,body #right-sidebar{display:flex;flex-direction:column;justify-content:center}body #left-sidebar .open,body #left-sidebar .close,body #right-sidebar .open,body #right-sidebar .close{position:absolute;bottom:10%;width:30px;height:30px;border-radius:10em}body #left-sidebar .dialog,body #right-sidebar .dialog{max-height:100%;display:flex;flex-direction:column;align-items:center}body #left-sidebar .dialog .heading,body #right-sidebar .dialog .heading{flex-grow:0;flex-shrink:0;width:100%;padding:.5em;font-size:1.3em}body #left-sidebar .dialog .content,body #right-sidebar .dialog .content{flex-grow:1;width:100%;overflow-y:auto;margin:0}body #right-sidebar .dialog .content{padding:1em}body #right-sidebar .dialog .content button{width:100%;font-size:1.1em;padding:.3em 1em;transition:background .1s;font-weight:bold;border-radius:2px}body #right-sidebar .dialog .content #toggle_theme_wrapper{width:2em;height:2em;margin-top:1em;cursor:pointer;padding:5px;border-radius:3px}body #right-sidebar .dialog .content #toggle_theme_wrapper #toggle_theme{width:100%;height:100%;mask-image:url("/static/img/icons/moon.svg");mask-position:center;mask-repeat:no-repeat;mask-size:contain;-webkit-mask-image:url("/static/img/icons/moon.svg");-webkit-mask-position:center;-webkit-mask-repeat:no-repeat;-webkit-mask-size:contain}body #right-sidebar .open{left:-50px;transform:rotateZ(180deg)}body #right-sidebar .close{left:20px}body #left-sidebar .content{padding-left:2em}body #left-sidebar li{line-height:1.5em;margin:.5em 0}body #left-sidebar .open{right:-50px}body #left-sidebar .close{right:20px;transform:rotateZ(180deg)}@media(min-width: 800px){body #left-sidebar .open,body #left-sidebar .close,body #right-sidebar .open,body #right-sidebar .close{display:none !important}}@media(min-width: 800px){*::-webkit-scrollbar{width:10px;height:10px;background:#d3d3d3}*::-webkit-scrollbar-thumb{background:gray;border-radius:1em;border:2px solid #d3d3d3}*::-webkit-scrollbar-thumb:hover{background:#444343}}.bg{z-index:-2;position:fixed;top:0;left:0;width:100vw;height:100vh;object-fit:cover;filter:brightness(40%);transition:opacity 500ms}#view_bg_btn{z-index:3;width:5em;height:5em;padding:1em;border-radius:100%;position:fixed;left:-2em;bottom:-2em;transition:left .1s linear,bottom .1s linear,width .1s linear,height .1s linear;display:flex;justify-content:center;align-items:center}#view_bg_btn:hover{left:-1em;bottom:-1em;width:7em;height:7em}#view_bg_btn #screen_img{width:70%;height:50%;border:2px solid}.image_viewer{opacity:0;position:fixed;top:0;left:0;width:100vw;height:100vh;overflow:scroll;z-index:4;transition:opacity .2s linear;pointer-events:all;display:flex;align-items:center;justify-content:center}@media(max-width: 800px){.image_viewer{padding:1em}}@media(min-width: 800px){.image_viewer{padding:5em}}.image_viewer>img{max-width:100%;max-height:100%;object-fit:contain;border-radius:5px;border:3px solid}@media(max-width: 800px){body>.first_body_wrapper{transition:opacity .2s linear}body #left-sidebar,body #right-sidebar{transition:left .2s ease-out;z-index:1}body #left-sidebar.up,body #right-sidebar.up{z-index:2;left:0}body #left-sidebar.up .open,body #right-sidebar.up .open{display:none}body #left-sidebar.up .close,body #right-sidebar.up .close{display:block}body #left-sidebardown,body #right-sidebardown{opacity:0}body #left-sidebar .close,body #right-sidebar .close{display:none}}@media(min-width: 800px){body>.first_body_wrapper{opacity:1 !important}}#body_wrapper header{padding:1em}#body_wrapper header #main_title{padding:0 1em;width:100%;text-align:center;margin-top:1em}#body_wrapper header nav{display:flex;flex-wrap:wrap;justify-content:space-around;align-items:baseline;grid-gap:1em}#body_wrapper header nav a{text-decoration:none;color:inherit;font-weight:500;padding:.5em 1em;min-width:10em;border-radius:.3em;text-align:center}#body_wrapper article{line-height:2em;padding:0 1em;overflow:hidden}#body_wrapper article section{margin:1em 0;padding:1em}#body_wrapper article section p,#body_wrapper article section prog,#body_wrapper article section blockquote{margin:1rem 0}@media(max-width: 800px){#body_wrapper header{padding:0 0 1em}#body_wrapper header nav{width:100%;flex-direction:column;align-items:center;grid-gap:0}#body_wrapper header nav a{border-radius:0;width:100%;padding:1.5em}#body_wrapper header nav a+a{border-top:none}#body_wrapper article{padding:0}}#body_wrapper footer{display:flex;flex-direction:column;align-items:center;width:100%;padding:1em;grid-gap:1em}#body_wrapper footer .links{display:flex;align-items:center;justify-content:center;grid-gap:3em}@media(max-width: 800px){#body_wrapper footer .links{flex-direction:column;grid-gap:2em}}#body_wrapper footer .links .social .footer-title{font-size:1.2em;font-weight:bold;text-align:center;margin-bottom:.5em}#body_wrapper footer .links .social>*{margin:0 .5em}.tags_list{display:flex;align-items:center;justify-content:center;grid-gap:1em;flex-wrap:wrap;width:100%;margin:1em 0;list-style:none;padding:0 1em}.tags_list .tag_element{display:block}.tag_element{text-align:center;cursor:pointer;min-width:8em;line-height:1rem;padding:.3em 1em;font-size:.8em;border-radius:10em}.tag_element:hover{text-decoration:none}prog{font-size:.85em;line-height:1.5em;font-family:"Roboto Mono",monospace;display:block;white-space:pre;padding:.5em;overflow-x:auto;margin-top:5px}prog *{background:none !important}progi,formula{font-family:"Roboto Mono",monospace;padding:.15em .2em;border-radius:5px;border:2px solid;overflow-x:auto;overflow-y:hidden;white-space:nowrap;max-width:100%;display:inline-block;vertical-align:middle;line-height:1em}blockquote{padding:1em 2em;border-left:5px solid}h1,h2,h3,h4,h5,h6{line-height:1em;font-weight:bold;word-break:break-word}h1{font-size:2em}h2{font-size:1.5em;text-align:center;border-radius:5px;padding:5px}h3{font-size:1.3em}h4{font-size:1.2em}h5{font-size:1.1em}h6{font-size:1em}em{font-style:italic}.graphviz{display:flex;justify-content:center;margin:1em}@media(max-width: 800px){ul,ol{padding:1em}}.post_card{margin:1em;padding:1em;border:3px solid;border-radius:1em}.post_card>*{margin:.5em}.post_card .post_description{line-height:1.5em}*{transition:background .1s ease-in,shitfuck 1s ease-in}body.light{color:#111}body.light #left-sidebar .open,body.light #left-sidebar .close,body.light #right-sidebar .open,body.light #right-sidebar .close{background:rgba(0,0,0,.3333333333)}body.light #left-sidebar .dialog,body.light #right-sidebar .dialog{background:#fcfdf7}body.light #left-sidebar .dialog .heading,body.light #right-sidebar .dialog .heading{background:linear-gradient(to top, #fcfdf7, 5%, #cede7d)}body.light #right-sidebar button{color:#111;background:none;border:1px solid #dde9a5}body.light #right-sidebar button:hover{background:#dde9a5}body.light #right-sidebar #toggle_theme_wrapper:hover{background-color:rgba(0,0,0,.1333333333)}body.light #right-sidebar #toggle_theme_wrapper #toggle_theme{background-color:#000}body.light #view_bg_btn{background:rgba(50,50,50,.7)}body.light #view_bg_btn #screen_img{border-color:#2a2a2a;background:#575656}body.light .image_viewer{background:rgba(0,0,0,.95)}body.light .image_viewer>img{border-color:#0e0e2a}body.light header{background:#e9ffa4}body.light header nav a{background:#f6a75c}body.light header nav a.current{background:#d75404}@media(min-width: 800px){body.light header nav a:hover{background:#d75404}}body.light footer{background:#e9ffa4}body.light footer .footer-title{color:#032a71}body.light article{background:rgba(255,255,255,.1333333333)}body.light article section{background:#fcfdf7}body.light a{color:#3c8f17;text-decoration:none}body.light a:visited{color:#3c8f17}body.light a:hover{text-decoration:none;color:#28620e}body.light a.tag_element{color:#111;background:#d5ecbc}body.light a.tag_element:visited{color:#111}body.light a.tag_element:hover{color:#111;background:#bde5a3}body.light prog,body.light formula{background:#fff}body.light progi{background:#fff;border-color:#c1bfbf}body.light blockquote{border-color:#f8aeae;background:#fdcfd2}body.light h2{background:#dde9a5}body.light .post_card{background:#edf3ce;border-color:#dde9a5}body.dark{color:#cecdcd}body.dark #left-sidebar .open,body.dark #left-sidebar .close,body.dark #right-sidebar .open,body.dark #right-sidebar .close{background:rgba(0,0,0,.3333333333)}body.dark #left-sidebar .dialog,body.dark #right-sidebar .dialog{background:#1f2021}body.dark #left-sidebar .dialog .heading,body.dark #right-sidebar .dialog .heading{background:linear-gradient(to top, #1f2021, 5%, #383a3b)}body.dark #right-sidebar button{color:#cecdcd;background:none;border:1px solid #505356}body.dark #right-sidebar button:hover{background:#505356}body.dark #right-sidebar #toggle_theme_wrapper:hover{background-color:rgba(255,255,255,.1333333333)}body.dark #right-sidebar #toggle_theme_wrapper #toggle_theme{background-color:#fff}body.dark #view_bg_btn{background:rgba(50,50,50,.7)}body.dark #view_bg_btn #screen_img{border-color:#2a2a2a;background:#575656}body.dark .image_viewer{background:rgba(0,0,0,.95)}body.dark .image_viewer>img{border-color:#0e0e2a}body.dark header{background:#2b2f2a}body.dark header nav a{background:#3e3244}body.dark header nav a.current{background:#1c171e}@media(min-width: 800px){body.dark header nav a:hover{background:#1c171e}}body.dark footer{background:#2b2f2a}body.dark footer .footer-title{color:#75a6ff}body.dark article{background:rgba(255,255,255,.1333333333)}body.dark article section{background:#1f2021}body.dark a{color:#3c8f17;text-decoration:none}body.dark a:visited{color:#3c8f17}body.dark a:hover{text-decoration:none;color:#28620e}body.dark a.tag_element{color:#cecdcd;background:#481515}body.dark a.tag_element:visited{color:#cecdcd}body.dark a.tag_element:hover{color:#cecdcd;background:#341010}body.dark prog{background:#000}body.dark progi,body.dark formula{background:#000;border-color:#414141}body.dark blockquote{border-color:#f8aeae;background:#331d34}body.dark h2{background:#2b2d2e}body.dark .post_card{background:#131314;border-color:#000}/*# sourceMappingURL=styles.css.map */
</style><link rel="preconnect" href="https://fonts.gstatic.com"><meta name="description" content="Documentation for 'datest', a clojure(script) testing framework designed to be used from the REPL"><meta name="keywords" content="clojure"><title>Datest</title><noscript>
        <style>
          #left-sidebar .open, #left-sidebar .close, #right-sidebar .open, #right-sidebar .close, #right-sidebar #toggle_theme_wrapper, #view_bg_btn {
            display: none;
          } 
        </style>
      </noscript></head><body render_date="Sun Nov 05 2023 12:05:11 GMT+0530 (India Standard Time)" class="light"><script src="/static/js/dynamic-pre.js"></script>









<img alt="background" class="bg" id="main_bg" src="/static/img/bg.webp" loading="lazy"><div id="view_bg_btn" onclick="show_image_tag(document.querySelector('#main_bg'))"><div id="screen_img"></div></div><div id="left-sidebar">
    <div class="dialog">
        <div class="heading">Table of content</div>
        <ol class="content"><li><a href="#top">Top</a></li><li><a href="#distinguishingfeatures">Distinguishing features</a></li><li><a href="#definingatestsuite">Defining a test suite</a></li><li><a href="#manipulatingtestsuites">Manipulating test suites</a></li><li><a href="#runningtestsuites">Running test suites</a></li><li><a href="#teststate">Test state</a></li><li><a href="#utilities">Utilities</a></li></ol>
    </div>
    <img alt="open left sidebar" src="/static/img/icons/swipe.svg" class="open">
    <img alt="close left sidebar" src="/static/img/icons/swipe.svg" class="close">
</div><div id="right-sidebar">
    <div class="dialog">
        <div class="heading">Settings</div>
        <div class="content">
            <button>Subscribe</button>
            <div id="toggle_theme_wrapper"><div id="toggle_theme"></div>
        </div>
    </div>
    <img alt="open right sidebar" src="/static/img/icons/swipe.svg" class="open">
    <img alt="close right sidebar" src="/static/img/icons/swipe.svg" class="close">
</div></div><div id="body_wrapper" class="first_body_wrapper"><header><nav><a href="/">
              HOME
          </a><a href="/projects.html">
              PROJECTS
          </a><a href="/tags.html">
              TAGS
          </a><a href="/about.html">
              ABOUT
          </a></nav><h1 id="main_title">Datest</h1><ul class="tags_list"><li><a class="tag_element" href="/tags/clojure.html">clojure</a></li></ul></header><article role="main">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    
<section id="top"><h2 style="display: none;">Top</h2><p>
        <a href="https://clojars.org/org.clojars.stiwar/datest">Datest</a> is a data oriented unit testing framework for clojure.
        This page will serve as its documentation.
    </p></section><section id="distinguishingfeatures"><h2>Distinguishing features</h2><ol>
      <li>Designed to be used from REPL</li>
      <li>Test suites and test results are clojure values that you can manipulate in the REPL</li>
      <li>Cleans stack traces to only contain frames from your module</li>
      <li>Works with both clojure and clojurescript</li>
    </ol></section><section id="definingatestsuite"><h2>Defining a test suite</h2><p>
        <progi role="figure">testing</progi> macro is used to define the test suite tree. The leaf nodes in this tree will contain the
        testing logic and the inner nodes will be used to group multiple test suites. An invocation of the
        <progi role="figure">testing</progi> macro returns a test suite as a value:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">def</span> suite1 <span class="token punctuation">(</span>testing <span class="token operator">:test</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span>
                     <span class="token operator">:message</span> <span class="token string">"A simple test suite"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog><p>
        The first argument to the macro is the name of the test suite (<progi role="figure">:test</progi> in this case). How the rest
        of the arguments are interpreted depends on whether the test suite is a leaf node or an inner node.
    </p><h3>Leaf Nodes</h3><p>
        Leaf nodes must have a vector after the name. The above example is a leaf node. As you can see, it looks
        like a function call. You are supposed to put all the testing logic inside these "functions". It must return a
        clojure map with <progi role="figure">:result</progi> as a key. It can throw an exception as well. The test result will have the
        stack trace with unnecessary stack frames filtered out (clojure.core, clojure.lang, etc).<br>
        The empty vector isn't there just for marking the leaf nodes. I'll describe how to use them later.
    </p><h3>Inner Nodes</h3><p>
        Inner nodes must contain nested <progi role="figure">testing</progi> macro calls following the name:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">def</span> suite2 <span class="token punctuation">(</span>testing <span class="token operator">:a</span>
                     <span class="token punctuation">(</span>testing <span class="token operator">:b</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                              <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                     <span class="token punctuation">(</span>testing <span class="token operator">:c</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                              <span class="token punctuation">{</span><span class="token operator">:result</span>  <span class="token operator">:ERR</span>
                               <span class="token operator">:message</span> <span class="token string">"failing test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                     <span class="token punctuation">(</span>testing <span class="token operator">:d</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                              <span class="token punctuation">(</span><span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token keyword">new</span> Error<span class="token punctuation">)</span><span class="token punctuation">)</span>
                              <span class="token punctuation">{</span><span class="token operator">:result</span>  <span class="token operator">:OK</span>
                               <span class="token operator">:message</span> <span class="token string">"ignored"</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span></prog></section><section id="manipulatingtestsuites"><h2>Manipulating test suites</h2><p>
        You can combine multiple test suites into a single suite using <progi role="figure">combine-tests</progi> function:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">def</span> combined <span class="token punctuation">(</span>combine-tests <span class="token punctuation">[</span>suite1 suite2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog><p>
        You can define parts of test suite in different modules and combine them into one big suite in
        the main testing module.
    </p><p>
        You can also pull out parts of the test suite because it's a regular clojure map:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">def</span> suite3 <span class="token punctuation">(</span><span class="token keyword">get</span> combined <span class="token operator">:test</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">def</span> suite4 <span class="token punctuation">(</span>get-in combined <span class="token punctuation">[</span><span class="token operator">:a</span> <span class="token operator">:c</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog><p>
        This can be used to run a subset of the full test suite.
    </p></section><section id="runningtestsuites"><h2>Running test suites</h2><p>
        <progi role="figure">run-test</progi> function can be used to execute a test suite. It returns a result tree whose structure
        matches that of the given test suite.
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>run-test combined<span class="token punctuation">)</span>
<span class="token keyword">=</span>&gt;
<span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span><span class="token punctuation">,</span> <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token operator">:c</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span><span class="token punctuation">,</span> <span class="token operator">:message</span> <span class="token string">"failing test"</span><span class="token punctuation">,</span> <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token operator">:d</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:EXCEPTION</span><span class="token punctuation">,</span>
         <span class="token operator">:exception</span> #error<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token operator">:test</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span><span class="token punctuation">,</span> <span class="token operator">:message</span> <span class="token string">"A simple test suite"</span><span class="token punctuation">,</span> <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></prog><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>run-test <span class="token punctuation">(</span>get-in combined <span class="token punctuation">[</span><span class="token operator">:a</span> <span class="token operator">:c</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">=</span>&gt; <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span><span class="token punctuation">,</span> <span class="token operator">:message</span> <span class="token string">"failing test"</span><span class="token punctuation">,</span> <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></prog></section><section id="teststate"><h2>Test state</h2><p>
        Consider the following test unit:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>testing <span class="token operator">:suite</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
         <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token number">a</span> <span class="token punctuation">(</span>get_a<span class="token punctuation">)</span>
               <span class="token number">b</span> <span class="token punctuation">(</span>get_b <span class="token number">a</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
           <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span>valid_value? <span class="token number">b</span><span class="token punctuation">)</span>
             <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span><span class="token punctuation">}</span>
             <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span>
              <span class="token operator">:cause</span>  <span class="token string">"Invalid result"</span>
              <span class="token operator">:a</span>      <span class="token number">a</span>
              <span class="token operator">:b</span>      <span class="token number">b</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog><p>
        What if <progi role="figure">get-b</progi> throws an exception. You'll get the following result when you execute this test:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">{</span><span class="token operator">:result</span>    <span class="token operator">:EXCEPTION</span>
 <span class="token operator">:exception</span> #error<span class="token punctuation">}</span></prog><p>
        The exception info will contain the stack trace, but not the value of local variable <progi role="figure">a</progi> that
        caused <progi role="figure">get-b</progi> to throw an exception.
    </p><p>
        Datest has the concept of state variables that can help with this. The state variables for a test unit are
        declared in the argument vector of the "function" for that test unit:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>testing <span class="token operator">:suite</span> <span class="token punctuation">[</span>val_a<span class="token punctuation">]</span>
         <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token number">a</span> <span class="token punctuation">(</span>get_a<span class="token punctuation">)</span>
               _ <span class="token punctuation">(</span>reset! val_a <span class="token number">a</span><span class="token punctuation">)</span>
               <span class="token number">b</span> <span class="token punctuation">(</span>get_b <span class="token number">a</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
           <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span>valid_value? <span class="token number">b</span><span class="token punctuation">)</span>
             <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:OK</span><span class="token punctuation">}</span>
             <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span>
              <span class="token operator">:cause</span>  <span class="token string">"Invalid result"</span>
              <span class="token operator">:a</span>      <span class="token number">a</span>
              <span class="token operator">:b</span>      <span class="token number">b</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></prog><p>
        The execution context of the test unit will have an atom for each state variable that is declared. You can store
        intermediate state of the test unit inside these atoms, and this state will be available in the test result:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">{</span><span class="token operator">:suite</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:EXCEPTION</span><span class="token punctuation">,</span>
         <span class="token operator">:exception</span> #error<span class="token punctuation">,</span>
         <span class="token operator">:state</span> <span class="token punctuation">{</span>val_a <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></prog></section><section id="utilities"><h2>Utilities</h2><p>
      <progi role="figure">get-failed</progi> : Return test results with <progi role="figure">(not= status :OK)</progi>:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>get-failed <span class="token punctuation">(</span>run-test combined<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:c</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span><span class="token punctuation">,</span> <span class="token operator">:message</span> <span class="token string">"failing test"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token operator">:d</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:EXCEPTION</span><span class="token punctuation">,</span>
         <span class="token operator">:exception</span> #error<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></prog><p>
        <progi role="figure">flatten-result/treefy-result</progi> : Can be used to iterate over test results:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">-&gt;&gt;</span> <span class="token punctuation">(</span>run-test combined<span class="token punctuation">)</span>
     flatten-result
     <span class="token punctuation">(</span><span class="token keyword">filter</span> my-result-filter<span class="token punctuation">)</span>
     treefy-result<span class="token punctuation">)</span></prog><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span><span class="token keyword">def</span> failed <span class="token punctuation">(</span>flatten-result <span class="token punctuation">(</span>get-failed <span class="token punctuation">(</span>run-test combined<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; number of failed results</span>
<span class="token punctuation">(</span><span class="token keyword">count</span> failed<span class="token punctuation">)</span>

<span class="token comment">; first failed test:</span>
<span class="token punctuation">(</span><span class="token keyword">first</span> failed<span class="token punctuation">)</span>

<span class="token comment">; stats about test results</span>
<span class="token punctuation">(</span>frequencies <span class="token punctuation">(</span><span class="token keyword">map</span> <span class="token operator">:result</span> <span class="token punctuation">(</span>flatten-result <span class="token punctuation">(</span>run-test combined<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token operator">:OK</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">:ERR</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">:EXCEPTION</span> <span class="token number">1</span><span class="token punctuation">}</span></prog><p>
      <progi role="figure">return-comparison</progi> : Compare two objects and return a result with their comparison:
    </p><prog class=" language-clojure" role="figure"><span class="token punctuation">(</span>run-test <span class="token punctuation">(</span>testing <span class="token operator">:test</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                   <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>expected <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token number">1</span>
                                       <span class="token operator">:c</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                         actual <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token number">1</span>
                                     <span class="token operator">:c</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
                     <span class="token punctuation">(</span>return-comparison expected actual<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">=</span>&gt;
<span class="token punctuation">{</span><span class="token operator">:test</span> <span class="token punctuation">{</span><span class="token operator">:main</span> <span class="token punctuation">{</span><span class="token operator">:result</span> <span class="token operator">:ERR</span><span class="token punctuation">,</span>
               <span class="token operator">:expected</span> <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">:c</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token operator">:actual</span> <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">:c</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token operator">:diff</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:c</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:c</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">:a</span> <span class="token punctuation">{</span><span class="token operator">:b</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token operator">:state</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></prog><p>
        <progi role="figure">:diff</progi> sequence is the result of <progi role="figure">clojure.data/diff</progi>. First element is data that is only
        in expected response, second element is data only in actual response, third element is common data.
    </p></section></article><footer>
    <div class="links">
        <div class="social">
            <div class="footer-title">Share this page:</div>
            <a rel="noopener" title="twitter" class="svg-icon twitter" target="_blank" href="https://twitter.com/share?text=Datest&amp;url=https://amokfa.github.io/posts/datest.html"></a>
            <a rel="noopener" title="facebook" class="svg-icon facebook" target="_blank" href="https://www.facebook.com/sharer.php?u=https://amokfa.github.io/posts/datest.html"></a>
            <a rel="noopener" title="reddit" class="svg-icon reddit" target="_blank" href="https://www.reddit.com/submit?title=Datest&amp;url=https://amokfa.github.io/posts/datest.html"></a>
            <a rel="noopener" title="hacker news" class="svg-icon hn" target="_blank" href="https://news.ycombinator.com/submitlink?t=Datest&amp;u=https://amokfa.github.io/posts/datest.html"></a>
        </div>
    </div>

</footer></div><script src="/static/js/dynamic-post.js" defer=""></script><script src="/static/js/mtm.js" defer=""></script><div id="post_load_css" style="display: none;"><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&amp;family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="/static/css/prism.css"></div></body></html>